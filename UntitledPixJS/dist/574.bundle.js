"use strict";(self.webpackChunktemplate_pixijs=self.webpackChunktemplate_pixijs||[]).push([[574],{8574:(t,e,i)=>{i.r(e),i.d(e,{Scene_Mobile:()=>d});var s=i(3742),n=i(4972),h=i(7769),o=i(1971),r=i(9512);class d extends n.x{constructor(){super(),this.bg=o.jyi.from(r.Z.Image.bgYellow),this.bg.anchor.set(.5),this.dragon=o.jyi.from(r.Z.Image.dragon),this.dragon.anchor.set(.5),this.window_message=new s.K,this.window_message.x=8,this.addChild(this.bg,this.dragon,this.window_message),this.interactive=!0,this.on("pointerdown",this.onClick.bind(this)),console.log(this),["試著說第一句話","然後說第二句話","接著說第三句很長很長很長很長很長很長很長很長很長很長很長很長很長很長很長很長的話\n而且是有換行那種"].forEach((t=>this.window_message.appendText(t))),this.window_message.waitForEmpty().then((()=>{console.log("說完話了！")})),this.dragon.on("pointerdown",(()=>{this.window_message.typing||this.window_message.appendText("飛飛乖！\n咕姆姆姆姆姆姆...")})),this.dragon.interactive=!0,this.onWindowResize()}destroy(t){document.removeEventListener("resize",this.onWindowResize.bind(this),!0),super.destroy(t)}update(t){super.update(t)}onClick(t){}onWindowResize(){super.onWindowResize(),console.log("resize"),this.bg.x=h.Z.screen.width/2,this.bg.y=h.Z.screen.height/2,this.dragon.x=h.Z.screen.width/2,this.dragon.y=h.Z.screen.height/2}}},4972:(t,e,i)=>{i.d(e,{x:()=>h});var s=i(1971),n=i(5601);class h extends s.W20{constructor(){super(),this.hitArea=new s.AeJ(0,0,n.V.width,n.V.height)}onInit(){}onDestroy(){this.destroy({children:!0})}update(t){this.children.forEach((e=>{var i,s;return null===(s=(i=e).update)||void 0===s?void 0:s.call(i,t)}))}onWindowResize(){this.children.forEach((t=>{var e,i;null===(i=(e=t).onWindowResize)||void 0===i||i.call(e)}))}}},3742:(t,e,i)=>{i.d(e,{K:()=>p});var s=i(1971),n=i(5601);class h extends s.W20{constructor(t){super(),this.bufferTexts=[],this.bufferText="",this.displayingText="",this._nextCharCooldown=0,this._typingPromise=null,this._typingPromiseResolver=null,this._text=new s.xvT("",n.M.Window_Message),this.addChild(this._text),t&&(t.text&&this.appendText(t.text),t.texts&&t.texts.forEach((t=>this.appendText(t)))),console.log(this)}update(t){var e,i;if(this.typing)if(this._nextCharCooldown>=0)this._nextCharCooldown-=t;else for(;this._nextCharCooldown<=0&&this.typing;)if(null===(e=this.bufferText)||void 0===e?void 0:e.length)this._text.text=`${this._text.text}${this.bufferText.at(0)}`,this.bufferText=this.bufferText.slice(1),console.log("[Sprite_TypingText] 目前文字",this._text,"剩餘文字",this.bufferText),this._nextCharCooldown+=1;else{if(!(null===(i=this.bufferTexts)||void 0===i?void 0:i.length))return this.typing=!1,void(this._typingPromiseResolver&&(this._typingPromiseResolver(),this._typingPromiseResolver=null,this._typingPromise=null));this.typing=!1}}nextSentence(){this.typing||(this._text.text="",this.bufferText=this.bufferTexts.shift(),this.typing=!0)}appendText(t){console.log("[Sprite_TypingText] 加入了文字：",t),this.bufferTexts.push(t),this.typing||this.nextSentence(),this.typing=!0,this._typingPromise||(this._typingPromise=new Promise(((t,e)=>{this._typingPromiseResolver=t})))}waitForEmpty(){return this.typing||this.bufferTexts.length||this.bufferText?this._typingPromise:Promise.resolve()}IsEmpty(){var t,e;return!(null===(t=this.bufferTexts)||void 0===t?void 0:t.length)&&!(null===(e=this.bufferText)||void 0===e?void 0:e.length)}IsSentenceCompleted(){var t;return 0===(null===(t=this.bufferText)||void 0===t?void 0:t.length)}get textStyle(){return this._text.style}set textStyle(t){this._text.style=t}}class o extends s.W20{constructor(){super(),this.bg=new s.TCu,this.addChild(this.bg),window.addEventListener("resize",this.onWindowResize.bind(this)),this.onWindowResize()}onWindowResize(){this.bg.clear(),this.bg.beginFill(3355511,.5),this.bg.drawRect(0,0,this.width,this.height)}update(t){this.children.forEach((e=>{var i,s;return null===(s=(i=e).update)||void 0===s?void 0:s.call(i,t)}))}destroy(t){window.removeEventListener("resize",this.onWindowResize.bind(this)),super.destroy(t)}}var r=i(9512),d=i(7769);class p extends o{constructor(){super(),this.animFrame=0,this.sprite_typingText=new h,this.sprite_typingText.x=8,this.sprite_typingText.y=8,this.downIcon=new s.jyi(s.xEZ.from(r.Z.Image.jewelBlueSmall)),this.downIcon.anchor.set(1,1),this.addChild(this.downIcon,this.sprite_typingText),this.on("pointerdown",this.onPointerDown.bind(this)),this.interactive=!0,this.onWindowResize()}update(t){super.update(t),this.animFrame+=t,this.typing||(this.downIcon.visible=!0,this.downIcon.y=128+4*Math.sin(this.animFrame/8))}onPointerDown(){this.IsEmpty()?this.visible=!1:(this.nextSentence(),this.visible=!0)}get typing(){return this.sprite_typingText.typing}nextSentence(){return this.sprite_typingText.nextSentence()}appendText(t){return this.visible=!0,this.sprite_typingText.appendText(t)}waitForEmpty(){return this.sprite_typingText.waitForEmpty()}IsEmpty(){return this.sprite_typingText.IsEmpty()}IsSentenceCompleted(){return this.sprite_typingText.IsSentenceCompleted()}onWindowResize(){this.downIcon&&(super.onWindowResize(),this.bg.width=Math.min(640,d.Z.screen.width)-32,this.bg.height=144,this.x=d.Z.screen.width/2-this.bg.width/2,this.y=d.Z.screen.height-this.height-16,this.downIcon.x=this.bg.width-16,this.downIcon.y=this.bg.height-16,this.sprite_typingText.textStyle.wordWrapWidth=this.bg.width-16)}}}}]);