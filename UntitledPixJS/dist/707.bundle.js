"use strict";(self.webpackChunktemplate_pixijs=self.webpackChunktemplate_pixijs||[]).push([[707],{9707:(t,i,e)=>{e.r(i),e.d(i,{Scene_MobileMap:()=>m});var s=e(6715),h=e(5601),a=e(7254),n=e(1971);class o extends a.r{constructor(){super(),this.minWidth=320,this.minHeight=128,this.titleText=new n.xvT("",h.M.Dialog_MapConfirm_Title),this.titleText.x=8,this.titleText.y=8,this.descriptionText=new n.xvT("",h.M.Dialog_MapConfirm_Description),this.descriptionText.x=8,this.descriptionText.y=this.titleText.y+Number(h.M.Dialog_MapConfirm_Title.fontSize)+8,this.OKButton=new s.E("OK"),this.OKButton.interactive=!0,this.OKButton.on("pointerdown",(()=>{this.Close(!0)})),this.CancelButton=new s.E("Cancel"),this.CancelButton.interactive=!0,this.CancelButton.on("pointerdown",(()=>{this.Close()})),this.addChild(this.titleText,this.descriptionText,this.OKButton,this.CancelButton),this.visible=!1}onWindowResize(){this.descriptionText&&(super.onWindowResize(),this.descriptionText.style.wordWrapWidth=this.width-16,this.OKButton.x=this.width-this.OKButton.width,this.OKButton.y=this.descriptionText.y+this.descriptionText.height+32,this.CancelButton.x=this.OKButton.x-this.CancelButton.width-8,this.CancelButton.y=this.OKButton.y,this.centerWindow())}Open(t,i,e){this.titleText.text=t,this.descriptionText.text=i,this.visible=!0,this.callback=e,this.onWindowResize()}Close(t){var i;null===(i=this.callback)||void 0===i||i.call(this,t),this.visible=!1}}var r=e(8519),l=e(4972),d=e(9512);e(7630),e(2599),e(3328),e(4794),e(2141),e(8683),e(5831),e(5274);class c extends n.W20{constructor(){super(),this.loadingText=new n.xvT("Loading",h.M.Sprite_Loading),this.loadingText.y=(this.loadingText.width-this.loadingText.height)/2,this.particles=new n.W20,this.particles.x=this.loadingText.width/2,this.particles.y=this.loadingText.width/2;for(let t=0;t<6;t++){const t=new n.TCu;t.beginFill(13421772,.75),t.drawCircle(0,0,8),t.endFill(),t.beginFill(16777215,1),t.drawCircle(0,0,4),t.endFill(),this.particles.addChild(t)}this.addChild(this.loadingText,this.particles),console.log(this)}update(t){const i=(new Date).getTime();this.particles.children.forEach(((t,e)=>{t.scale.set(.75*Math.cos(2*Math.PI*e/this.particles.children.length+i/720)+1),t.x=this.loadingText.width/2*Math.sin(2*Math.PI*e/this.particles.children.length+i/720),t.y=this.loadingText.width/2*Math.sin(2*Math.PI*e/this.particles.children.length+i/720)})),this.particles.angle=i/72}onWindowResize(){this.x=r.Z.screen.width/2-this.width/2,this.y=r.Z.screen.height/2-this.width/2}}e(1526),e(1690),e(816),e(6151),e(7553),e(2903);var g=e(8194);const p=[{name:"家",description:"溫暖的龍窩！<3",x:200,y:200,visible:!0,image:d.ZP.Image.MapPointHome,events:[{condition:()=>!0,payload:()=>{}}],home:!0},{name:"時間神殿",description:"時間神殿",x:400,y:200,visible:!0,events:[{condition:()=>!0,payload:()=>{}}]},{name:"競技場",description:"競技場",x:400,y:400,visible:!0,events:[{condition:()=>!0,payload:()=>{}}]},{name:"源淨森林",description:"源淨森林",x:200,y:600,visible:!0,events:[{condition:()=>!0,payload:()=>{}}]}];class x extends n.jyi{constructor(t){super();const i=t.image instanceof Function?t.image():t.image;this.texture=n.xEZ.from(i||d.ZP.Image.MapPoint),this.interactive=!0,this.cursor="pointer",this.nameText=new n.xvT(t.name instanceof Function?t.name():t.name,h.M.Sprite_MapMobile),this.nameText.anchor.set(.5,0),this.nameText.y=this.texture.height,this.nameText.x=this.texture.width/2,this.addChild(this.nameText)}}class m extends l.x{constructor(){super(),g.eq.stopAll(),this.bg=n.jyi.from(d.ZP.Image.bgRed),this.addChild(this.bg),this.dragon=n.jyi.from(d.ZP.Image.dragon),this.dragon.anchor.set(.5),this.dragon.scale.set(.5),this.dragon.x=0,this.dragon.y=0,this.targetX=0,this.targetY=0,this.bg.addChild(this.dragon);for(let t of p){const i=new x(t);i.x=(t.x instanceof Function?t.x():t.x)||Math.random()*this.bg.width,i.y=(t.y instanceof Function?t.y():t.y)||Math.random()*this.bg.height,i.interactive=!0,i.on("pointerdown",(s=>{this.targetX=i.x,this.targetY=i.y,g.eq.play(d.HJ.cursor),this.dialog_MapConfirm.Open(t.name instanceof Function?t.name():t.name,t.description instanceof Function?t.description():t.description,(async i=>{if(i){if(g.eq.play(d.HJ.piano),t.home){const t=await Promise.resolve().then(e.bind(e,9886)).then((t=>t.Scene_Mobile));return r.Z.stage.children.forEach((t=>t.destroy({children:!0}))),r.Z.stage.removeChildren(),void r.Z.stage.addChild(new t)}this.sprite_loading.visible=!0}else g.eq.play(d.HJ.cancel)}))})),this.bg.addChild(i)}this.backButton=new s.E("回家",null,{width:64,height:64}),this.backButton.callback=async()=>{const t=await Promise.resolve().then(e.bind(e,9886)).then((t=>t.Scene_Mobile));r.Z.stage.children.forEach((t=>t.destroy({children:!0}))),r.Z.stage.removeChildren(),r.Z.stage.addChild(new t)},this.addChild(this.backButton),this.sprite_loading=new c,this.sprite_loading.visible=!1,this.addChild(this.sprite_loading),this.dialog_MapConfirm=new o,this.addChild(this.dialog_MapConfirm),this.onWindowResize(),g.eq.play(d.HJ.BGM_MobileMap,{loop:!0}),this.bg.interactive=!0,this.bg.on("pointerdown",this.onPointerDown.bind(this)),this.bg.on("pointerup",this.onPointerUp.bind(this)),this.bg.on("pointermove",this.onPointerMove.bind(this))}onDestroy(){this.bg.off("pointerdown",this.onPointerDown.bind(this)),this.bg.off("pointermove",this.onPointerMove.bind(this)),super.onDestroy()}update(t){this.dragon.x+=(this.targetX-this.dragon.x)/Math.max(1,16/t),this.dragon.y+=(this.targetY-this.dragon.y)/Math.max(1,16/t),super.update(t)}onPointerDown(t){this.lastPointerX=t.x,this.lastPointerY=t.y}onPointerUp(t){this.lastPointerX=t.x,this.lastPointerY=t.y}onPointerMove(t){t.buttons&&(this.bg.x+=t.x-this.lastPointerX,this.bg.y+=t.y-this.lastPointerY),this.bg.x=Math.min(0,Math.max(-this.bg.width+r.Z.screen.width,this.bg.x)),this.bg.y=Math.min(0,Math.max(-this.bg.height+r.Z.screen.height,this.bg.y)),this.lastPointerX=t.x,this.lastPointerY=t.y}onWindowResize(){super.onWindowResize(),this.backButton.x=r.Z.screen.width-this.backButton.width-16,this.backButton.y=r.Z.screen.height-this.backButton.height-16,r.Z.screen.width<r.Z.screen.height||r.Z.screen.width/r.Z.screen.height<16/9?(this.bg.height=r.Z.screen.height,this.bg.width=this.bg.height/9*16):(this.bg.width=r.Z.screen.width,this.bg.height=this.bg.width/16*9),this.bg.x=0,this.bg.y=0}}},2599:(t,i,e)=>{e.d(i,{p:()=>a});var s=e(1971),h=e(9512);class a extends s.jyi{constructor(){super(s.xEZ.from(h.ZP.Image.closeBtn)),this.interactive=!0,this.on("pointertap",this.onDown.bind(this))}onDown(){this.parent?this.parent.destroy():console.warn("無Parent可供關閉！")}}},3328:(t,i,e)=>{e.d(i,{i:()=>a});var s=e(1971),h=e(5601);class a extends s.W20{constructor(t,i,e){super(),this.animFrame=0;const h="number"==typeof t?Math.abs(t).toString():t;this.damageText=new s.xvT(h,this.getDamageStyle(t,i,e)),this.damageText.anchor.set(.5),this.addChild(this.damageText),e&&(this.criticalText=new s.xvT("Critical",this.getDamageStyle("Critical",i,e)),this.criticalText.anchor.set(.5),this.criticalText.y=-24,this.damageText.addChild(this.criticalText))}getDamageStyle(t,i,e){return"number"==typeof t?i?t>0?h.M.Sprite_Damage_SP:h.M.Sprite_Damage_SP_Plus:e&&t>0?h.M.Sprite_Damage_HP_Critical:t>0?h.M.Sprite_Damage_HP:h.M.Sprite_Damage_HP_Plus:e?h.M.Sprite_Damage_Critical:h.M.Sprite_Damage}update(t){if(this.animFrame>=72)return void this.destroy({children:!0});const i=Math.sin(Math.PI*this.animFrame/72),e=Math.cos(Math.PI/2*this.animFrame/72);this.damageText.x=128*(1-e),this.damageText.y=128*-i,this.damageText.scale.set(.75*e+.25),this.animFrame+=t}}},4794:(t,i,e)=>{e.d(i,{$:()=>h});var s=e(1971);class h extends s.jyi{constructor(){super(s.xEZ.from("imgs/5.png")),this.anchor.set(.5),this.target={x:0,y:0},this.startPos=null}update(){}}},2141:(t,i,e)=>{e.d(i,{_:()=>n});var s=e(1971),h=e(5601);const a=128;class n extends s.W20{constructor(t){super(),this.lastVal=0,this.maxVal=0,this.displayVal=0,this.animStartVal=0,this.animTime=0,this.battler=t,this.graphicVal=new s.TCu,this.graphicDelta=new s.TCu,this.text=new s.xvT("0",h.M.Sprite_HealthBar),this.text.anchor.set(1,0),this.text.x=a;const i=new s.TCu;i.beginFill(2236962),i.drawRect(0,0,a,8),i.endFill(),i.y=12,this.graphicVal.beginFill(43520),this.graphicVal.drawRect(0,0,a,8),this.graphicVal.endFill(),this.graphicDelta.beginFill(11141120),this.graphicDelta.drawRect(0,0,a,8),this.graphicDelta.endFill(),this.graphicVal.scale.x=0,this.graphicDelta.scale.x=0,this.graphicDelta.y=12,this.graphicVal.y=12,this.addChild(i,this.graphicVal,this.graphicDelta,this.text),console.log(this)}update(t){if(this.battler&&(this.maxVal=this.battler.maxhp,this.lastVal=this.battler.hp),!this.maxVal)return;this.animTime>0&&(this.animTime-=t,this.displayVal=this.animTime>0?this.animStartVal-(this.animStartVal-this.lastVal)*Math.cos(this.animTime*Math.PI/60/2):this.lastVal);const i=Math.min(1,this.lastVal/this.maxVal);this.graphicVal.scale.x=i;const e=Math.min((this.displayVal-this.lastVal)/this.maxVal);this.graphicDelta.scale.x=e,this.graphicDelta.x=this.graphicVal.x+a*i,this.text.text=Math.round(this.displayVal).toString()}setHealth(t,i){i&&(this.maxVal=i),this.lastVal=Math.min(this.maxVal,Math.max(0,t))}flush(){this.animStartVal=this.displayVal,this.animTime=60}}},8683:(t,i,e)=>{e.d(i,{l:()=>h});var s=e(1971);class h extends s.W20{constructor(t){super(),this.map=new t,this.sortableChildren=!0,this.width=this.map.width,this.height=this.map.height,this.map.items.forEach((t=>{const i=s.jyi.from(t.texture);i.x=t.x,i.y=t.y,i.zIndex=t.layer,t.onInteract&&(i.interactive=!0,i.on("pointertap",(e=>t.onInteract.bind(e,i)))),t.update&&Object.defineProperty(i,"update",(e=>{t.update(i,e)})),this.addChild(i)}))}update(t){this.children.forEach((i=>{var e;return null===(e=i.update)||void 0===e?void 0:e.call(i,t)}))}}},5831:(t,i,e)=>{e.d(i,{k:()=>h});var s=e(1971);class h extends s.KgH{constructor(){const t={};for(let i=1;i<=9;i++)for(let e=0;e<4;e++){if(5===i)continue;const h=`M_ ${i}_${e}.ase`;t[i]||(t[i]=[]),t[i].push({texture:s.xEZ.from(h),time:133})}super(t[2]),this.sprTextures=t,this.moveSpeed=8,this.anchor.set(.5),this.animationSpeed=1,this.target={x:0,y:0}}update(t){if(this.target){const t=Math.atan2(this.target.y-this.y,this.target.x-this.x),i=Math.cos(t)*this.moveSpeed,e=Math.sin(t)*this.moveSpeed;this.x+=i,this.y+=e;const s=(180*t/Math.PI+360)%360,h=[6,3,2,1,4,7,8,9][Math.floor(s/45)];this.setMovingAnim(h,!0)}else this.setMovingAnim(null,!1)}setMovingAnim(t,i){this.sprTextures[t]&&t>=0&&this.direction!=t&&(this.textures=this.sprTextures[t],this.animationSpeed=1,this.play(),this.direction=t),this.moving!=i&&(i?this.play():this.stop()),this.moving=i}}},6151:(t,i,e)=>{e.d(i,{G:()=>o});var s=e(1971),h=e(5601),a=e(2599),n=e(9512);class o extends s.W20{constructor(){super();const t=new s.TCu;t.beginFill(5592405,.5),t.drawRect(0,0,320,120);const i=s.jyi.from(s.xEZ.from(n.ZP.Image.jewelRed));i.x=8,i.y=8,i.interactive=!0;const e=new s.xvT("1",h.M.Window_MapItem);i.addChild(e),e.anchor.set(1,1),e.x=24,e.y=32;const o=new a.p;o.anchor.set(.5),o.x=304,o.y=16,this.addChild(o),this.addChild(t),this.addChild(i)}update(){}}}}]);