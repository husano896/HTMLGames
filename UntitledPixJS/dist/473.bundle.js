"use strict";(self.webpackChunktemplate_pixijs=self.webpackChunktemplate_pixijs||[]).push([[473],{473:(t,i,e)=>{e.r(i),e.d(i,{Scene_Map:()=>w});var s,h=e(7553),a=e(5601),n=e(9512);!function(t){t[t.Layer_None=0]="Layer_None",t[t.Layer_Normal=5]="Layer_Normal",t[t.Layer_High=10]="Layer_High"}(s||(s={}));class r{constructor(){this.name="Map01",this.width=a.V.width,this.height=a.V.height,this.frame=0,this.items=[{layer:s.Layer_None,texture:n.ZP.Image.bg,width:800,height:600,x:0,y:0},{layer:s.Layer_Normal,texture:n.ZP.Image.jewelBlue,x:400,y:400,update:(t,i)=>{}}]}}var o=e(8683),l=e(6151),d=e(3328),p=e(2141),c=e(569),x=e.n(c),g=e(4972),u=e(5831),m=e(3514),y=e(1971);class w extends g.x{constructor(){super(),this.map=new o.l(r),this.addChild(this.map),this.sprite_seto=new u.k,this.sprite_healthBar=new p._(m.tk.battler),this.sprite_healthBar.x=320,this.sprite_healthBar.y=8,this.addChild(this.sprite_healthBar),this.on("pointertap",this.onDown.bind(this)),this.on("pointermove",this.onMove.bind(this)),this.on("pointerup",this.onUp.bind(this)),this.interactive=!0,this.holding=!1,this.windows_container=new y.W20,this.addChild(this.windows_container),this.windows_container.addChild(new l.G);const t=new h.K;t.y=240,this.windows_container.addChild(t),console.log(this)}easeOutSine(t){return Math.sin(t*Math.PI/2)}easeOutSineFunc(t,i,e){return i+(e-i)*Math.sin(t*Math.PI/2)}update(t){(new Date).getTime(),this.children.forEach((i=>{var e;return null===(e=i.update)||void 0===e?void 0:e.call(i,t)})),this.windows_container.children.forEach((i=>{var e;return null===(e=i.update)||void 0===e?void 0:e.call(i,t)}));const i={x:0,y:0};x().isKeyDown("ArrowUp")?i.y=-1:x().isKeyDown("ArrowDown")&&(i.y=1),x().isKeyDown("ArrowLeft")?i.x=-1:x().isKeyDown("ArrowRight")&&(i.x=1),0===i.x&&0===i.y||(this.sprite_seto.target={x:this.sprite_seto.x+i.x,y:this.sprite_seto.y+i.y}),this.holding||i||(this.sprite_seto.target=null)}onDown(t){const i=t.data.global.x,e=t.data.global.y;this.holding=!0;const s=Math.round(2e3*Math.random()-1e3),h=new d.i(s,Math.random()>.5,Math.random()>.5);h.x=i,h.y=e,this.addChild(h),m.tk.battler.hp=m.tk.battler.hp-s,this.sprite_healthBar.flush(),console.log(this.sprite_healthBar,m.tk.battler),console.log(h)}onMove(t){const i=t.data.global.x,e=t.data.global.y;this.sprite_seto.target={x:i,y:e}}onUp(t){t.data.global.x,t.data.global.y,this.holding=!1}}},4972:(t,i,e)=>{e.d(i,{x:()=>h});var s=e(1971);class h extends s.W20{constructor(){super()}onInit(){}onDestroy(){this.destroy({children:!0})}update(t){this.children.forEach((i=>{var e,s;return null===(s=(e=i).update)||void 0===s?void 0:s.call(e,t)}))}onWindowResize(){this.children.forEach((t=>{var i,e;null===(e=(i=t).onWindowResize)||void 0===e||e.call(i)}))}}},2599:(t,i,e)=>{e.d(i,{p:()=>a});var s=e(1971),h=e(9512);class a extends s.jyi{constructor(){super(s.xEZ.from(h.ZP.Image.closeBtn)),this.interactive=!0,this.on("pointertap",this.onDown.bind(this))}onDown(){this.parent?this.parent.destroy():console.warn("無Parent可供關閉！")}}},3328:(t,i,e)=>{e.d(i,{i:()=>a});var s=e(1971),h=e(5601);class a extends s.W20{constructor(t,i,e){super(),this.animFrame=0;const h="number"==typeof t?Math.abs(t).toString():t;this.damageText=new s.xvT(h,this.getDamageStyle(t,i,e)),this.damageText.anchor.set(.5),this.addChild(this.damageText),e&&(this.criticalText=new s.xvT("Critical",this.getDamageStyle("Critical",i,e)),this.criticalText.anchor.set(.5),this.criticalText.y=-24,this.damageText.addChild(this.criticalText))}getDamageStyle(t,i,e){return"number"==typeof t?i?t>0?h.M.Sprite_Damage_SP:h.M.Sprite_Damage_SP_Plus:e&&t>0?h.M.Sprite_Damage_HP_Critical:t>0?h.M.Sprite_Damage_HP:h.M.Sprite_Damage_HP_Plus:e?h.M.Sprite_Damage_Critical:h.M.Sprite_Damage}update(t){if(this.animFrame>=72)return void this.destroy({children:!0});const i=Math.sin(Math.PI*this.animFrame/72),e=Math.cos(Math.PI/2*this.animFrame/72);this.damageText.x=128*(1-e),this.damageText.y=128*-i,this.damageText.scale.set(.75*e+.25),this.animFrame+=t}}},2141:(t,i,e)=>{e.d(i,{_:()=>n});var s=e(1971),h=e(5601);const a=128;class n extends s.W20{constructor(t){super(),this.lastVal=0,this.maxVal=0,this.displayVal=0,this.animStartVal=0,this.animTime=0,this.battler=t,this.graphicVal=new s.TCu,this.graphicDelta=new s.TCu,this.text=new s.xvT("0",h.M.Sprite_HealthBar),this.text.anchor.set(1,0),this.text.x=a;const i=new s.TCu;i.beginFill(2236962),i.drawRect(0,0,a,8),i.endFill(),i.y=12,this.graphicVal.beginFill(43520),this.graphicVal.drawRect(0,0,a,8),this.graphicVal.endFill(),this.graphicDelta.beginFill(11141120),this.graphicDelta.drawRect(0,0,a,8),this.graphicDelta.endFill(),this.graphicVal.scale.x=0,this.graphicDelta.scale.x=0,this.graphicDelta.y=12,this.graphicVal.y=12,this.addChild(i,this.graphicVal,this.graphicDelta,this.text),console.log(this)}update(t){if(this.battler&&(this.maxVal=this.battler.maxhp,this.lastVal=this.battler.hp),!this.maxVal)return;this.animTime>0&&(this.animTime-=t,this.displayVal=this.animTime>0?this.animStartVal-(this.animStartVal-this.lastVal)*Math.cos(this.animTime*Math.PI/60/2):this.lastVal);const i=Math.min(1,this.lastVal/this.maxVal);this.graphicVal.scale.x=i;const e=Math.min((this.displayVal-this.lastVal)/this.maxVal);this.graphicDelta.scale.x=e,this.graphicDelta.x=this.graphicVal.x+a*i,this.text.text=Math.round(this.displayVal).toString()}setHealth(t,i){i&&(this.maxVal=i),this.lastVal=Math.min(this.maxVal,Math.max(0,t))}flush(){this.animStartVal=this.displayVal,this.animTime=60}}},8683:(t,i,e)=>{e.d(i,{l:()=>h});var s=e(1971);class h extends s.W20{constructor(t){super(),this.map=new t,this.sortableChildren=!0,this.width=this.map.width,this.height=this.map.height,this.map.items.forEach((t=>{const i=s.jyi.from(t.texture);i.x=t.x,i.y=t.y,i.zIndex=t.layer,t.onInteract&&(i.interactive=!0,i.on("pointertap",(e=>t.onInteract.bind(e,i)))),t.update&&Object.defineProperty(i,"update",(e=>{t.update(i,e)})),this.addChild(i)}))}update(t){this.children.forEach((i=>{var e;return null===(e=i.update)||void 0===e?void 0:e.call(i,t)}))}}},5831:(t,i,e)=>{e.d(i,{k:()=>h});var s=e(1971);class h extends s.KgH{constructor(){const t={};for(let i=1;i<=9;i++)for(let e=0;e<4;e++){if(5===i)continue;const h=`M_ ${i}_${e}.ase`;t[i]||(t[i]=[]),t[i].push({texture:s.xEZ.from(h),time:133})}super(t[2]),this.sprTextures=t,this.moveSpeed=8,this.anchor.set(.5),this.animationSpeed=1,this.target={x:0,y:0}}update(t){if(this.target){const t=Math.atan2(this.target.y-this.y,this.target.x-this.x),i=Math.cos(t)*this.moveSpeed,e=Math.sin(t)*this.moveSpeed;this.x+=i,this.y+=e;const s=(180*t/Math.PI+360)%360,h=[6,3,2,1,4,7,8,9][Math.floor(s/45)];this.setMovingAnim(h,!0)}else this.setMovingAnim(null,!1)}setMovingAnim(t,i){this.sprTextures[t]&&t>=0&&this.direction!=t&&(this.textures=this.sprTextures[t],this.animationSpeed=1,this.play(),this.direction=t),this.moving!=i&&(i?this.play():this.stop()),this.moving=i}}},5274:(t,i,e)=>{e.d(i,{U:()=>a});var s=e(1971),h=e(5601);class a extends s.W20{constructor(t){super(),this.typing=!1,this.bufferTexts=[],this.bufferText="",this.displayingText="",this._nextCharCooldown=0,this._typingPromise=null,this._typingPromiseResolver=null,this._text=new s.xvT("",h.M.Window_Message),this.addChild(this._text),t&&(t.text&&this.appendText(t.text),t.texts&&t.texts.forEach((t=>this.appendText(t))))}update(t){var i,e;if(this.typing)if(this._nextCharCooldown>=0)this._nextCharCooldown-=t;else for(;this._nextCharCooldown<=0&&this.typing;)if(null===(i=this.bufferText)||void 0===i?void 0:i.length)this._text.text=`${this._text.text}${this.bufferText.at(0)}`,this.bufferText=this.bufferText.slice(1),this._nextCharCooldown+=1;else{if(!(null===(e=this.bufferTexts)||void 0===e?void 0:e.length))return this.typing=!1,void(this._typingPromiseResolver&&(this._typingPromiseResolver(),this._typingPromiseResolver=null,this._typingPromise=null));this.typing=!1}}nextSentence(){this.typing||(this._text.text="",this.bufferText=this.bufferTexts.shift(),this.typing=!0)}appendText(t){this.bufferTexts.push(t),this.typing||this.nextSentence(),this.typing=!0,this._typingPromise||(this._typingPromise=new Promise(((t,i)=>{this._typingPromiseResolver=t})))}waitForEmpty(){return this.typing||this.bufferTexts.length||this.bufferText?this._typingPromise:Promise.resolve()}IsEmpty(){var t,i;return!(null===(t=this.bufferTexts)||void 0===t?void 0:t.length)&&!(null===(i=this.bufferText)||void 0===i?void 0:i.length)}IsSentenceCompleted(){var t;return 0===(null===(t=this.bufferText)||void 0===t?void 0:t.length)}get textStyle(){return this._text.style}set textStyle(t){this._text.style=t}}},6151:(t,i,e)=>{e.d(i,{G:()=>r});var s=e(1971),h=e(5601),a=e(2599),n=e(9512);class r extends s.W20{constructor(){super();const t=new s.TCu;t.beginFill(5592405,.5),t.drawRect(0,0,320,120);const i=s.jyi.from(s.xEZ.from(n.ZP.Image.jewelRed));i.x=8,i.y=8,i.interactive=!0;const e=new s.xvT("1",h.M.Window_MapItem);i.addChild(e),e.anchor.set(1,1),e.x=24,e.y=32;const r=new a.p;r.anchor.set(.5),r.x=304,r.y=16,this.addChild(r),this.addChild(t),this.addChild(i)}update(){}}},7553:(t,i,e)=>{e.d(i,{K:()=>o});var s=e(5274),h=e(1971),a=e(7254),n=e(9512),r=e(8519);class o extends a.r{constructor(){super(),this.animFrame=0,this.sprite_typingText=new s.U,this.sprite_typingText.x=8,this.sprite_typingText.y=8,this.downIcon=new h.jyi(h.xEZ.from(n.ZP.Image.jewelBlueSmall)),this.downIcon.anchor.set(1,1),this.addChild(this.downIcon,this.sprite_typingText),this.on("pointertap",this.onPointerTap),this.interactive=!0,this.cursor="pointer",this.visible=!1,this.onWindowResize()}update(t){super.update(t),this.animFrame+=t,this.typing||(this.downIcon.visible=!0,this.downIcon.y=128+4*Math.sin(this.animFrame/8))}onPointerTap(){this.IsEmpty()?this.visible=!1:(this.nextSentence(),this.visible=!0)}get typing(){return this.sprite_typingText.typing}nextSentence(){return this.sprite_typingText.nextSentence()}appendText(t){return this.visible=!0,this.sprite_typingText.appendText(t)}waitForEmpty(){return this.sprite_typingText.waitForEmpty()}IsEmpty(){return this.sprite_typingText.IsEmpty()}IsSentenceCompleted(){return this.sprite_typingText.IsSentenceCompleted()}onWindowResize(){this.downIcon&&(super.onWindowResize(),this.bg.width=Math.min(640,r.Z.screen.width)-32,this.bg.height=144,this.x=r.Z.screen.width/2-this.bg.width/2,this.y=r.Z.screen.height-this.height-16,this.downIcon.x=this.bg.width-16,this.downIcon.y=this.bg.height-16,this.sprite_typingText.textStyle.wordWrapWidth=this.bg.width-16)}}},7254:(t,i,e)=>{e.d(i,{r:()=>h});var s=e(1971);class h extends s.W20{constructor(){super(),this.bg=new s.TCu,this.addChild(this.bg),window.addEventListener("resize",this.onWindowResize.bind(this)),this.onWindowResize()}onWindowResize(){this.bg.clear(),this.bg.beginFill(3355511,.5),this.bg.drawRect(0,0,this.width,this.height),this.children.forEach((t=>{var i;return null===(i=t.onWindowResize)||void 0===i?void 0:i.call(t)}))}update(t){this.children.forEach((i=>{var e,s;return null===(s=(e=i).update)||void 0===s?void 0:s.call(e,t)})),this.visible!==this.lastVisible&&(this.lastVisible=this.visible),this.visible?this.alpha=Math.min(1,this.alpha+t*(1-this.alpha)/15):this.alpha=0}destroy(t){window.removeEventListener("resize",this.onWindowResize.bind(this)),super.destroy(t)}}}}]);