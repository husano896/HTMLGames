"use strict";(self.webpackChunktemplate_pixijs=self.webpackChunktemplate_pixijs||[]).push([[877],{8877:(t,i,e)=>{e.r(i),e.d(i,{Scene_MobileMap:()=>b,default:()=>u});var n=e(6715),s=e(5601),h=e(7254),o=e(1971);class a extends h.r{constructor(){super(),this.minWidth=320,this.minHeight=128,this.titleText=new o.xvT("",s.MU.Dialog_MapConfirm_Title),this.titleText.x=8,this.titleText.y=8,this.descriptionText=new o.xvT("",s.MU.Dialog_MapConfirm_Description),this.descriptionText.x=8,this.descriptionText.y=this.titleText.y+Number(s.MU.Dialog_MapConfirm_Title.fontSize)+8,this.OKButton=new n.E("OK",null,{width:48,height:32}),this.OKButton.interactive=!0,this.OKButton.on("pointerdown",(()=>{this.Close(!0)})),this.CancelButton=new n.E("Cancel",null,{width:48,height:32}),this.CancelButton.interactive=!0,this.CancelButton.on("pointerdown",(()=>{this.Close()})),this.addChild(this.titleText,this.descriptionText,this.OKButton,this.CancelButton),this.visible=!1}onWindowResize(){this.descriptionText&&(super.onWindowResize(),this.descriptionText.style.wordWrapWidth=this.width-16,this.OKButton.x=this.width-this.OKButton.width,this.OKButton.y=this.descriptionText.y+this.descriptionText.height+32,this.CancelButton.x=this.OKButton.x-this.CancelButton.width-8,this.CancelButton.y=this.OKButton.y,this.centerWindow())}Open(t,i,e){this.titleText.text=t,this.descriptionText.text=i,this.visible=!0,this.callback=e,this.onWindowResize()}Close(t){var i;null===(i=this.callback)||void 0===i||i.call(this,t),this.visible=!1}}var r=e(8519),d=e(4972),c=e(9512),l=e(871),g=e(8194);const p=[{name:"家",description:"溫暖的龍窩！<3",x:200,y:200,visible:!0,image:c.ZP.Image.MapPointHome,events:[{condition:()=>!0,payload:()=>{}}],home:!0},{name:"時間神殿",description:"時間神殿",x:400,y:200,visible:!0,events:[{condition:()=>!0,payload:()=>{}}]},{name:"競技場",description:"競技場",x:400,y:400,visible:!0,events:[{condition:()=>!0,payload:()=>{}}]},{name:"源淨森林",description:"源淨森林",x:200,y:600,visible:!0,events:[{condition:()=>!0,payload:()=>{}}]}];class x extends o.jyi{constructor(t){super();const i=t.image instanceof Function?t.image():t.image;this.texture=o.xEZ.from(i||c.ZP.Image.MapPoint),this.interactive=!0,this.cursor="pointer",this.nameText=new o.xvT(t.name instanceof Function?t.name():t.name,s.MU.Sprite_MapMobile),this.nameText.anchor.set(.5,0),this.nameText.y=this.texture.height,this.nameText.x=this.texture.width/2,this.addChild(this.nameText)}}class b extends d.x{constructor(){super(),g.eq.stopAll(),this.bg=o.jyi.from(c.ZP.Image.bgRed),this.addChild(this.bg),this.dragon=o.jyi.from(c.ZP.Image.dragon),this.dragon.anchor.set(.5),this.dragon.scale.set(.5),this.dragon.x=0,this.dragon.y=0,this.targetX=0,this.targetY=0,this.bg.addChild(this.dragon);for(let t of p){const i=new x(t);i.x=(t.x instanceof Function?t.x():t.x)||Math.random()*this.bg.width,i.y=(t.y instanceof Function?t.y():t.y)||Math.random()*this.bg.height,i.interactive=!0,i.on("pointerdown",(n=>{this.targetX=i.x,this.targetY=i.y,g.eq.play(c.HJ.cursor),this.dialog_MapConfirm.Open(t.name instanceof Function?t.name():t.name,t.description instanceof Function?t.description():t.description,(async i=>{i?(g.eq.play(c.HJ.piano),t.home?await(0,s.p4)((await Promise.resolve().then(e.bind(e,5065))).default):this.sprite_loading.visible=!0):g.eq.play(c.HJ.cancel)}))})),this.bg.addChild(i)}this.backButton=new l.EX("回家",void 0,{width:64,height:64}),this.backButton.callback=async()=>{(0,l.YC)(),await(0,s.p4)((await Promise.resolve().then(e.bind(e,5065))).default)},this.addChild(this.backButton),this.dialog_MapConfirm=new a,this.addChild(this.dialog_MapConfirm),this.onWindowResize(),g.eq.play(c.HJ.BGM_MobileMap,{loop:!0}),this.bg.interactive=!0,this.bg.on("pointerdown",this.onPointerDown.bind(this)),this.bg.on("pointerup",this.onPointerUp.bind(this)),this.bg.on("pointermove",this.onPointerMove.bind(this))}onDestroy(){this.bg.off("pointerdown",this.onPointerDown.bind(this)),this.bg.off("pointermove",this.onPointerMove.bind(this)),super.onDestroy()}update(t){this.dragon.x+=(this.targetX-this.dragon.x)/Math.max(1,16/t),this.dragon.y+=(this.targetY-this.dragon.y)/Math.max(1,16/t),super.update(t)}onPointerDown(t){this.lastPointerX=t.x,this.lastPointerY=t.y}onPointerUp(t){this.lastPointerX=t.x,this.lastPointerY=t.y}onPointerMove(t){t.buttons&&(this.bg.x+=t.x-this.lastPointerX,this.bg.y+=t.y-this.lastPointerY),this.bg.x=Math.min(0,Math.max(-this.bg.width+r.Z.screen.width,this.bg.x)),this.bg.y=Math.min(0,Math.max(-this.bg.height+r.Z.screen.height,this.bg.y)),this.lastPointerX=t.x,this.lastPointerY=t.y}onWindowResize(){super.onWindowResize(),this.backButton.x=r.Z.screen.width-this.backButton.width-16,this.backButton.y=r.Z.screen.height-this.backButton.height-16,r.Z.screen.width<r.Z.screen.height||r.Z.screen.width/r.Z.screen.height<16/9?(this.bg.height=r.Z.screen.height,this.bg.width=this.bg.height/9*16):(this.bg.width=r.Z.screen.width,this.bg.height=this.bg.width/16*9),this.bg.x=0,this.bg.y=0}}const u=b}}]);