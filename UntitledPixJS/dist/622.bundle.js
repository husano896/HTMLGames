"use strict";(self.webpackChunktemplate_pixijs=self.webpackChunktemplate_pixijs||[]).push([[622],{8002:(t,i,a)=>{a.d(i,{G:()=>n});var e,s=a(5601),h=a(9512);!function(t){t[t.Layer_None=0]="Layer_None",t[t.Layer_Normal=5]="Layer_Normal",t[t.Layer_High=10]="Layer_High"}(e||(e={}));class n{constructor(){this.name="Map01",this.width=s.V.width,this.height=s.V.height,this.frame=0,this.items=[{layer:e.Layer_None,texture:h.Z.Image.bg,width:800,height:600,x:0,y:0},{layer:e.Layer_Normal,texture:h.Z.Image.jewelBlue,x:400,y:400,update:(t,i)=>{}}]}}},4972:(t,i,a)=>{a.d(i,{x:()=>h});var e=a(1971),s=a(5601);class h extends e.W20{constructor(){super(),this.hitArea=new e.AeJ(0,0,s.V.width,s.V.height)}onInit(){}onDestroy(){}update(t){}}},4622:(t,i,a)=>{a.r(i),a.d(i,{Scene_Map:()=>M});var e=a(1971),s=a(5601),h=a(9512);class n extends e.W20{constructor(){super(),this.animFrame=0;const t=new e.TCu;t.beginFill(3355443,.75),t.drawRect(0,0,320,120);const i=new e.xvT("Message\nTest",s.M.Window_Message);i.x=16,i.y=16,this.downIcon=new e.jyi(e.xEZ.from(h.Z.Image.jewelBlueSmall)),this.downIcon.anchor.set(.5),this.downIcon.x=304,this.downIcon.y=104,this.addChild(t),this.addChild(i),this.addChild(this.downIcon)}update(t){this.animFrame+=t,this.downIcon.y=104+4*Math.sin(this.animFrame/8)}}var r=a(8002),o=a(8683);class l extends e.jyi{constructor(){super(e.xEZ.from(h.Z.Image.closeBtn)),this.interactive=!0,this.on("pointertap",this.onDown.bind(this))}onDown(){this.parent?this.parent.destroy():console.warn("無Parent可供關閉！")}}class d extends e.W20{constructor(){super();const t=new e.TCu;t.beginFill(5592405,.5),t.drawRect(0,0,320,120);const i=e.jyi.from(e.xEZ.from(h.Z.Image.jewelRed));i.x=8,i.y=8,i.interactive=!0;const a=new e.xvT("1",s.M.Window_MapItem);i.addChild(a),a.anchor.set(1,1),a.x=24,a.y=32;const n=new l;n.anchor.set(.5),n.x=304,n.y=16,this.addChild(n),this.addChild(t),this.addChild(i)}update(){}}class c extends e.W20{constructor(t,i,a){super(),this.animFrame=0;const s="number"==typeof t?Math.abs(t).toString():t;this.damageText=new e.xvT(s,this.getDamageStyle(t,i,a)),this.damageText.anchor.set(.5),this.addChild(this.damageText),a&&(this.criticalText=new e.xvT("Critical",this.getDamageStyle("Critical",i,a)),this.criticalText.anchor.set(.5),this.criticalText.y=-24,this.damageText.addChild(this.criticalText))}getDamageStyle(t,i,a){return"number"==typeof t?i?t>0?s.M.Sprite_Damage_SP:s.M.Sprite_Damage_SP_Plus:a&&t>0?s.M.Sprite_Damage_HP_Critical:t>0?s.M.Sprite_Damage_HP:s.M.Sprite_Damage_HP_Plus:a?s.M.Sprite_Damage_Critical:s.M.Sprite_Damage}update(t){if(this.animFrame>=72)return void this.destroy({children:!0});const i=Math.sin(Math.PI*this.animFrame/72),a=Math.cos(Math.PI/2*this.animFrame/72);this.damageText.x=128*(1-a),this.damageText.y=128*-i,this.damageText.scale.set(.75*a+.25),this.animFrame+=t}}const p=128;class m extends e.W20{constructor(t){super(),this.lastVal=0,this.maxVal=0,this.displayVal=0,this.animStartVal=0,this.animTime=0,this.battler=t,this.graphicVal=new e.TCu,this.graphicDelta=new e.TCu,this.text=new e.xvT("0",s.M.Sprite_HealthBar),this.text.anchor.set(1,0),this.text.x=p;const i=new e.TCu;i.beginFill(2236962),i.drawRect(0,0,p,8),i.endFill(),i.y=12,this.graphicVal.beginFill(43520),this.graphicVal.drawRect(0,0,p,8),this.graphicVal.endFill(),this.graphicDelta.beginFill(11141120),this.graphicDelta.drawRect(0,0,p,8),this.graphicDelta.endFill(),this.graphicVal.scale.x=0,this.graphicDelta.scale.x=0,this.graphicDelta.y=12,this.graphicVal.y=12,this.addChild(i,this.graphicVal,this.graphicDelta,this.text),console.log(this)}update(t){if(this.battler&&(this.maxVal=this.battler.maxhp,this.lastVal=this.battler.hp),!this.maxVal)return;this.animTime>0&&(this.animTime-=t,this.displayVal=this.animTime>0?this.animStartVal-(this.animStartVal-this.lastVal)*Math.cos(this.animTime*Math.PI/60/2):this.lastVal);const i=Math.min(1,this.lastVal/this.maxVal);this.graphicVal.scale.x=i;const a=Math.min((this.displayVal-this.lastVal)/this.maxVal);this.graphicDelta.scale.x=a,this.graphicDelta.x=this.graphicVal.x+p*i,this.text.text=Math.round(this.displayVal).toString()}setHealth(t,i){i&&(this.maxVal=i),this.lastVal=Math.min(this.maxVal,Math.max(0,t))}flush(){this.animStartVal=this.displayVal,this.animTime=60}}var x=a(569),g=a.n(x),u=a(4972);class w extends e.KgH{constructor(){const t={};for(let i=1;i<=9;i++)for(let a=0;a<4;a++){if(5===i)continue;const s=`M_ ${i}_${a}.ase`;t[i]||(t[i]=[]),t[i].push({texture:e.xEZ.from(s),time:133})}super(t[2]),this.sprTextures=t,this.moveSpeed=8,this.anchor.set(.5),this.animationSpeed=1,this.target={x:0,y:0}}update(t){if(this.target){const t=Math.atan2(this.target.y-this.y,this.target.x-this.x),i=Math.cos(t)*this.moveSpeed,a=Math.sin(t)*this.moveSpeed;this.x+=i,this.y+=a;const e=(180*t/Math.PI+360)%360,s=[6,3,2,1,4,7,8,9][Math.floor(e/45)];this.setMovingAnim(s,!0)}else this.setMovingAnim(null,!1)}setMovingAnim(t,i){this.sprTextures[t]&&t>=0&&this.direction!=t&&(this.textures=this.sprTextures[t],this.animationSpeed=1,this.play(),this.direction=t),this.moving!=i&&(i?this.play():this.stop()),this.moving=i}}var _=a(2794);class y{}y.battler=new class{constructor(t){t&&Object.entries(t).forEach((([t,i])=>this[t]=i)),this.fullRecover()}get hp(){return this._hp}set hp(t){this._hp=Math.max(0,Math.min(t,this._maxhp))}get maxhp(){return this._maxhp}set maxhp(t){this._maxhp=Math.max(0,Math.min(t,9999))}get sp(){return this._sp}set sp(t){this._sp=Math.max(0,Math.min(t,this._maxsp))}get maxsp(){return this._maxsp}set maxsp(t){this._maxsp=Math.max(0,Math.min(t,999))}get atk(){return this._atk}set atk(t){this._atk=Math.max(0,Math.min(t,999))}get def(){return this._def}set def(t){this._def=Math.max(0,Math.min(t,999))}get states(){return this._states}fullRecover(){this._hp=this._maxhp,this._sp=this._maxsp}addState(t){this._states.push(t)}removeState(t){_.Z.remove(this._states,t)}damage(t,i,a,e,s,h){let n=t;return e||(n+=n*(Math.random()-.5)*i*2,t>0&&(n-=this._def)),n=Math.round(n*t<0?0:n),this.hp-=n,n}}({maxhp:1e3,hp:1e3,maxsp:100,sp:100,atk:10,def:0}),y.ChatLogs=[],y.map={};class M extends u.x{constructor(){super(),this.map=new o.l(r.G),this.addChild(this.map),this.sprite_seto=new w,this.sprite_healthBar=new m(y.battler),this.sprite_healthBar.x=320,this.sprite_healthBar.y=8,this.addChild(this.sprite_healthBar),this.on("pointertap",this.onDown.bind(this)),this.on("pointermove",this.onMove.bind(this)),this.on("pointerup",this.onUp.bind(this)),this.interactive=!0,this.holding=!1,this.windows_container=new e.W20,this.addChild(this.windows_container),this.windows_container.addChild(new d);const t=new n;t.y=240,this.windows_container.addChild(t),console.log(this)}easeOutSine(t){return Math.sin(t*Math.PI/2)}easeOutSineFunc(t,i,a){return i+(a-i)*Math.sin(t*Math.PI/2)}update(t){(new Date).getTime(),this.children.forEach((i=>{var a;return null===(a=i.update)||void 0===a?void 0:a.call(i,t)})),this.windows_container.children.forEach((i=>{var a;return null===(a=i.update)||void 0===a?void 0:a.call(i,t)}));const i={x:0,y:0};g().isKeyDown("ArrowUp")?i.y=-1:g().isKeyDown("ArrowDown")&&(i.y=1),g().isKeyDown("ArrowLeft")?i.x=-1:g().isKeyDown("ArrowRight")&&(i.x=1),0===i.x&&0===i.y||(this.sprite_seto.target={x:this.sprite_seto.x+i.x,y:this.sprite_seto.y+i.y}),this.holding||i||(this.sprite_seto.target=null)}onDown(t){const i=t.data.global.x,a=t.data.global.y;this.holding=!0;const e=Math.round(2e3*Math.random()-1e3),s=new c(e,Math.random()>.5,Math.random()>.5);s.x=i,s.y=a,this.addChild(s),y.battler.hp=y.battler.hp-e,this.sprite_healthBar.flush(),console.log(this.sprite_healthBar,y.battler),console.log(s)}onMove(t){const i=t.data.global.x,a=t.data.global.y;this.sprite_seto.target={x:i,y:a}}onUp(t){t.data.global.x,t.data.global.y,this.holding=!1}}},8683:(t,i,a)=>{a.d(i,{l:()=>s});var e=a(1971);class s extends e.W20{constructor(t){super(),this.map=new t,this.sortableChildren=!0,this.width=this.map.width,this.height=this.map.height,this.map.items.forEach((t=>{const i=e.jyi.from(t.texture);i.x=t.x,i.y=t.y,i.zIndex=t.layer,t.onInteract&&(i.interactive=!0,i.on("pointertap",(a=>t.onInteract.bind(a,i)))),t.update&&Object.defineProperty(i,"update",(a=>{t.update(i,a)})),this.addChild(i)}))}update(t){this.children.forEach((i=>{var a;return null===(a=i.update)||void 0===a?void 0:a.call(i,t)}))}}}}]);